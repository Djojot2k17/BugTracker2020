@using BugTracker2020.Models.ViewModels
@model IEnumerable<ManageProjectUsersViewModel>

<div class="container pt-3">
  <!-- Project Management -->
  <div class="col-12">
    <div class="card bg-dark shadow-lg mb-4">
      <!-- Card Header - Dropdown -->
      <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between bg-dark">
        <h6 class="m-0 font-weight-bold text-gray-200">
          Assign user projects
        </h6>
        @if (TempData["UserAlreadyOn"] != null)
        {
          <p>@TempData["UserAlreadyOn"]</p>
        }
        <div class="dropdown no-arrow">
          <a class="dropdown-toggle"
             href="#"
             role="button"
             id="dropdownMenuLink"
             data-toggle="dropdown"
             aria-haspopup="true"
             aria-expanded="false">
            <i class="fas fa-ellipsis-v fa-sm fa-fw text-gray-400"></i>
          </a>
          <div class="dropdown-menu dropdown-menu-right shadow animated--fade-in"
               aria-labelledby="dropdownMenuLink">
            <div class="dropdown-header">Dropdown Header:</div>
            <a class="dropdown-item" href="#">Action</a>
            <a class="dropdown-item" href="#">Another action</a>
            <div class="dropdown-divider"></div>
            <a class="dropdown-item" href="#">Something else here</a>
          </div>
        </div>
      </div>
      <!-- Card Body -->
      <div class="card-body">
        <div class="card-text">
          <table class="table table-dark table-bordered rounded">
            <thead class="bg-gradient-dark text-gray-200">
              <tr>
                <th>
                  User
                </th>
                <th>Role</th>
                <th>
                  Assigned Projects
                </th>
                <th>
                  Assign Project to User
                </th>
                <th>Action</th>
              </tr>
            </thead>

            @foreach (var item in Model)
            {
              
              <form asp-controller="Projects" asp-action="AssignProjectToUser">
                <div asp-validation-summary="ModelOnly" class="text-danger"></div>
                @Html.Hidden("userId", item.User.Id)
                <tr>
                  <td style="vertical-align: middle;">
                    @item.User.FullName
                  </td>
                  <td style="vertical-align: middle;">
                    @item.UserRole.FirstOrDefault()
                  </td>
                  <td style="vertical-align: middle;">
                    @if (item.CurrentProjects.Count != 0)
                    {
                      foreach (var project in item.CurrentProjects)
                      {
                        <ul class="list-group list-group-flush">
                          <li class="list-group-item bg-dark d-flex justify-content-between align-items-center">
                            @*FIGURE OUT HOW TO REMOVE USER PROJECTS WITH A POST METHOD*@
                            @project.Name <a asp-controller="Projects" asp-action="RemoveAssignedProjectFromUser" asp-route-id="@project.Id" asp-route-userId="@item.User.Id" class="btn btn-dark p-1 px-3"><i class="fas fa-times"></i></a>
                          </li>
                        </ul>
                      }
                    }
                    else
                    {
                      <ul class="list-group list-group-flush">
                        <li class="list-group-item bg-dark">No Projects Assigned</li>
                      </ul>
                    }
                  </td>
                  <td style="vertical-align: middle;">
                    <select class="form-control bg-dark text-gray-200" asp-for="@item.SelectedProject" asp-items="@item.Projects">
                      <option value="">Choose project</option>
                    </select>
                  </td>
                  <td style="vertical-align: middle;">
                    <input type="submit" class="btn btn-dark border" value="Assign Project" />
                  </td>
                </tr>
              </form>
            }
          </table>
        </div>
      </div>
    </div>
  </div>
</div>